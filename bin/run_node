#!/usr/bin/env ruby --jit
require "bundler/setup"
require 'gossip'
puts "Ruby version: #{RUBY_VERSION}"

PORT = 4545

puts "Enter seed nodes"
input = gets
hosts = input.split(" ")
abort 'EOF' if hosts.nil?
puts "Operating with no seed nodes" if hosts.empty?

puts "Starting node"

node = Gossip::Integration::Udp::Node.new(nil, hosts, PORT)

node.subscribe do |host, status|
  puts "Update: #{host} entered state #{status}"
end

# Input thread (stdin)
puts "Ready\n"
begin
  node.start
rescue Interrupt
end
puts "\nDone"
